# 正则表达式(2)

# 一. 基本逻辑控制

逻辑计算符对于程序员来说在熟悉不过了，如：`&&`、`||`、`>=` 、`==`、`()` 等。这些符号组合在一起计算出一个**布尔**值。正则中逻辑控制也是类似的意思。比如正则`Hi` ，表示第一个字符等于H**并且**第二个字符等于i,它们是默认的`&&`计算。如果要表达**或**的关系，就在中间加一个`|` ，如`H|i`表示等于H**或**等于i;

正则中的逻辑控制符并不多，只有以下三组：

| `|` 或        | 如`hi|hello|hellow` 匹配其中一个单词即可。                   |
| ------------- | ------------------------------------------------------------ |
| `()` 子表达式 | 用于独立计算括号中的内容。如：`(张|李)建国` 表示第一个字符是张**或者**李。 |
| `{}` 数量控制 | 对字符或字表达式的数量范围进行限定。如：`张.{1,3}` 表示“张”后面只能跟**1到3**个任意字符。 |

## 1.1 `|` 或

`|` 表示或者的意思，类似编程中的条件`||` 。在正则中它作用于**字符**或**子表达式**。示例：`401|403|404|500` 匹配401、404、404、500中任一组字符。它的语法非常简单，日常工作中又特别常用，所以学习它性价比极高。下次多个关键字搜索记得加`|` 有逼格。

找出异常的HTTP状态码：

```
401|403|404|499|500
```

状态码包括：

- 401：未授权
- 403：无权限访问
- 404：找不到资源
- 499：服务器超时
- 500：服务内部错误

> 如果要匹配 **|** 本身，需要进行转义，如：`\|` 表示匹配 **|** 符号，或者放在自定义范围集中`[|]`也可以有同样效果。

## 1.2 `|` 或 在Unix 中使用

由于 `|` 在类Unix系统中是特殊字符，当你使用`grep`或 `vim` 进行正则搜索时，必须进行**转义**。如grep中正则搜索正确姿势是：

```shell
grep '401\|403\|404\|500' nginx.access.log
```

在vim 中输入`/` 开始正则搜索，同样`|`需要转义：

```
/401\|403\|\404|\500
```

这个转义确实麻烦，好在除了Mac或Linux终端，其它软件上使用`|`是不用转义的，请松一口气。

## 1.3 `()`子表达式

`()`在工作中极其常用，与编程中的括号作用类似 如 `(1+2)*3=9` ，它们都是把一段逻辑进行拆分独立运算，再组合一起。如`(www|mvn|test).coderead.cn` 表示子域名为www、mvn、test任意一个。这里子域名就是一个**子表达式**。试想如果把`()`去掉会怎么样？这时匹配结果就是 www或mvn或者test.coderead.cn，这显然不符合预期。

匹配coderead.cn下所有域名：

```
(www|mvn|test).coderead.cn
```

子域名包括：www、mvn、test

示例：[mvn.coderead.cn]()

## 1.4`()`嵌套子表达式

子表达式支持**嵌套**，如：`(www|mvn|test-(bj|sz|gz|sh)).coderead.cn` 表示 test子域名又可继续拆分为test-bj、test-sz、test-sh、test-gz。

# 二. {}数量控制

数量控制作用于**字符**或**子表达式**，已限制其数量范围。`\d{6}`表示必须是6位数字。请注意：一个`{}`仅作用于其前面的单个字符如：`hi{2}` 表示**hii**,而不是**hihi**。

数量控制有以下几种编写方式：

| 逻辑符           | 描述                                         |
| ---------------- | -------------------------------------------- |
| `{n}` 指定数量   | 匹配**n**个字符                              |
| `{n,m}` 指定范围 | 匹配**n**至**m**个字符，即至少n个，最多m个。 |
| `{n,}` n个及以上 | 匹配**n**个或者n个**以上**字符               |
| `*` 任意个       | 相当于`{0,}` 0个或无数个                     |
| `+` 至少1个      | 相当于 `{1,}`                                |
| `？` 0或1个      | 相当于 `{0,1}`                               |

## 2.1 `{n}` 指定数量

`{n}`匹配n个固定数量

匹配css样式中所有正确的**颜色**代码：

```
#[a-f\d]{6};
```

以 `#` 开头的6位十六进制数用于表示颜色，规律如下 ：

- 以`#`开头,以`;`结尾
- 6个字母(只能是`a-f`)或数字
- 字母不区分大小写

## 2.2 `{n,m}`指定范围

匹配**n**至**m**个字符，即至少n个，最多m个。

匹配文中所有验证码：

```
\d{4,6}
```

验证码长度为4-6个，请找出。

## 2.3 `{n,}`指定最小值

匹配至少**n**个字符。

## 2.4 `{}`作用于子表达式：

`{}`即可以作用在字符上，还可以作用于**子表达**示。如在文本中提取域名时可能包含 http:// 协议头，也可能不包含就可以这么写：

```
((http|https):\/\/){0,1}www.coderead.cn
```

## 2.5 `*+?`量词简写

由于量词在正则中大量使用，每次写个`{n,m}`太麻烦了，所以提供了三个简写符号：

- `*` 表示任意次 ，等同于`{0,}`
- `+`表示1次以上，等同于`{1,}`
- `?`表示0次或1次，等同于`{0,1}`

通过简写该正则`((http|https):\/\/){0,1}www.coderead.cn` 可以如何优化？

协议头部分是0或1个就可以用`?`代替，优化成`((http|https):\/\/)?www.coderead.cn`

此外https只比http多了一个*s*，就可以进一步优化成：`(https?:\/\/)?www.coderead.cn` 是不是就简单多了。

匹配文中指定的http链接：

```
https?:\/\/(\w+\.)?(\w)+\.(com|cn|io|net)
```

规则如下：

1. 必须以http或https开头
2. 必须以**com|cn|io|net**结尾
3. 域名只能是**数字、字母、下划线**组成
4. 子域名可以为空，如：http://coderead.cn

## 2.6 `?` 最少化匹配（懒惰匹配）

`?` 是正则中重点，也是一个难点。很多人就是从`?`开始犯晕，希望你能顺利掌握。在学习之前先问大家一个问题：下文包括几对`<span> </span>` 标签？

```html
<span>hello</span>  <span>uncle</span>
```

你以为是2对，其实是3对，因为整个文本也是1对。使用`<span>.*</span>` 它会匹配哪1队呢？它会直接匹配最大的第3对，这显然不符合我们的预期，这时就就可以在量词后加`?`，告诉引擎按最少化来匹配，

匹配出所有的标签对：

```
<span>.*?</span>
```

```html
<span>hello </span>  <span>uncle </span>
```

最后我们来总结`?`的定义：`?`表示最小化匹配，也叫懒惰匹配，只能用在量词后面，表示如果多个文本段同时满足条件，则匹配最短的。`?`可以用在所有量词后面，甚至是`??` ,但这个量词不能是固定的值，如:`hel{2}?o` 这是没有意义的。因为它不存在最少和最多。

# 三. 常见案例

## 3.1 匹配HTML注释

在阅读源码时，注释太多反而会影响阅读，这时我会用正则匹配出来，然后一键清除。好吧，本章过关练习就是它了，使用正则匹配**html** 注释。html有三种类型的注释，分别是：

1. `<!-- -->` 标签注释，作用于html 标签中，支持**换行**
2. `/* */` 脚本注释，作用于 javascript 中 ,支持**换行**
3. `//`脚本单行注释， 作用于 javascript 中，不支持换行

匹配出所有html 注释：

```
\/\/.*|<!--(.|\n)*?-->|\/\*(.|\n)*?\*\/
```

提醒项：

- `\`转义特殊字符
- `?`最少化匹配
- `.`不包括换行
- `\n`表示换行